{{package.projectName}}

## Prerequisites

* Node (version 14+)
* Yarn (version 1.22+)
* If using Mongo, make sure to download MongoDB, install, add bin folder to path, and run with `mongod`

<hr>

## To Run

### Locally
- Backend: `yarn run dev` (port 4070 by default, can be changed in config.js)
- Frontend: `yarn run dev:web` (port 5070 by default)

### Production
- Build: `yarn run build:all`
- Run backend: `yarn run start`
- Run frontend: `yarn run start:web`

### To populate test collection in Mongo database with test data
- `node express/setup.js`

### **Important**:
- If using authentication, session secret value needs to be changed in the config file (and gitignored)

<hr>

## Swagger docs auto-generated by TSOA
- `{{express.url}}/api/docs`

<hr>

## Authentication
- Authentication is done using [MetaMask](https://metamask.io/npm) and [Web3](https://www.npmjs.com/package/web3)
- On the frontend, [use-metamask](https://www.npmjs.com/package/use-metamask) is used to connect to an installed MetaMask wallet, [Web3](https://www.npmjs.com/package/web3) is used to get a signature to verify a user owns that wallet address.
- On the backend, [ethereumjs-util](https://www.npmjs.com/package/ethereumjs-util) is used to validate a given signature and return a [jsonwebtoken](https://www.npmjs.com/package/jsonwebtoken) to authorize future REST calls from the user

### Signup
The `/api/users/signup` endpoint creates a new user in the db with given ethereum address

### Login
The `/api/users/login` endpoint validates a given wallet signature. If valid,
a session token is created and returned with user data

<hr>

## REST examples with Superagent and TSOA
- GET
  ```js
  superagent.get(`${expressURL}/api/test`)
  ---
  @Get('api/test')
  getFunction()
  ```

- GET with query param
  ```js
  superagent.get(`${expressURL}/api/test?id=42`)
  ---
  @Get('api/test')
  getFunction(@Query() id?: number)
  ```

- GET with path param
  ```js
  superagent.get(`${expressURL}/api/test/42`)
  ---
  @Get('api/test/:id')
  getFunction(@Path() id: number)
  ```

- POST with body
  ```js
  superagent.post(`${expressURL}/api/test`, { id: 42 })
  ---
  @Post('api/test')
  postFunction(@Body() body: { id: number })
  ```
